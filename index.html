<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İST-DEĞERLEME | Mega Veri Paneli</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        #map { height: 550px; border-radius: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); z-index: 1; }
        .metric-card { transition: all 0.3s ease; border: 1px solid #f1f5f9; }
        .metric-card:hover { transform: translateY(-2px); border-color: #3b82f6; }
        .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
    </style>
</head>
<body class="bg-[#f8fafc]">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <aside class="w-full lg:w-[400px] p-6 space-y-6 overflow-y-auto bg-white border-r">
            <div class="mb-8">
                <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight">İST-DEĞERLEME <span class="text-blue-600">360</span></h1>
                <p class="text-xs text-slate-500 font-medium uppercase tracking-widest">Emlak ve Değerleme Müdürlüğü</p>
            </div>

            <div class="bg-blue-50 p-4 rounded-2xl">
                <h2 id="activeZone" class="text-xl font-bold text-blue-900">İstanbul Geneli</h2>
                <p class="text-sm text-blue-600">Şubat 2026 Piyasa Analizi</p>
            </div>

            <div class="space-y-4">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-tighter">Piyasa Arz (Sahibinden Verisi)</h3>
                
                <div class="metric-card bg-white p-5 rounded-2xl shadow-sm">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-slate-500">Güncel İlan</span>
                        <span id="trend-badge" class="px-2 py-1 bg-green-100 text-green-700 text-[10px] font-bold rounded-full">+%4.2</span>
                    </div>
                    <div id="mainListingCount" class="text-3xl font-black text-slate-800 mt-1">135,654</div>
                    <div class="mt-4 grid grid-cols-3 gap-2 text-center border-t pt-4">
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold">3 Ay</p>
                            <p id="m3-change" class="text-sm font-bold text-emerald-600">+2.1%</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold">6 Ay</p>
                            <p id="m6-change" class="text-sm font-bold text-blue-600">+8.4%</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold">1 Yıl</p>
                            <p id="y1-change" class="text-sm font-bold text-slate-800">+12.4%</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-tighter">Talep ve Satış (TÜİK Verisi)</h3>
                <div class="metric-card bg-slate-900 p-5 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center text-slate-400 mb-2">
                        <span class="text-xs font-bold uppercase">Gerçekleşen Satış</span>
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div id="tuikSales" class="text-2xl font-bold text-white">18,240 <span class="text-xs text-slate-400 font-normal">/ ay</span></div>
                    <div class="mt-3 bg-slate-800 h-2 rounded-full overflow-hidden">
                        <div id="liquidityBar" class="bg-blue-500 h-full" style="width: 14%"></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2 font-medium italic">* Arzın %13.4'ü satışa dönüştü.</p>
                </div>
            </div>

            <div class="bg-gradient-to-br from-orange-500 to-red-600 p-5 rounded-2xl text-white shadow-xl shadow-red-100">
                <h3 class="text-xs font-bold uppercase opacity-80">Değerleme Risk Skoru</h3>
                <div id="riskScore" class="text-4xl font-black mt-1">4.2 <span class="text-sm font-normal">/ 10</span></div>
                <p id="riskText" class="text-[11px] mt-2 leading-relaxed opacity-90 font-medium">Bu bölgede fiyat şişmesi (Bubble) düşük, alım iştahı dengeli.</p>
            </div>
        </aside>

        <main class="flex-1 p-6 space-y-6">
            <header class="flex justify-between items-center">
                <h2 class="text-xl font-bold text-slate-800">İnteraktif Değerleme Haritası</h2>
                <button onclick="resetData()" class="text-xs font-bold text-blue-600 hover:underline">TÜM İSTANBUL'U GÖSTER</button>
            </header>

            <div id="map"></div>

            <div class="bg-white p-6 rounded-3xl shadow-sm border">
                <h3 class="text-sm font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-chart-area mr-2 text-blue-500"></i> 12 Aylık Arz & Satış Trendi (Detaylı Endeks)
                </h3>
                <div class="h-[300px]">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DATA ENGINE (TÜİK & SAHİBİNDEN BİRLEŞİK) ---
        const MASTER_DATA = {
            "İstanbul Geneli": {
                listings: 135654,
                tuik: 18240,
                m3: 2.1, m6: 8.4, y1: 12.4,
                history: [112000, 115000, 118000, 122000, 125000, 128000, 129000, 131000, 132500, 134000, 135000, 135654],
                tuikHistory: [14200, 15000, 14500, 16000, 17200, 18000, 17500, 18500, 19200, 18800, 18000, 18240],
                risk: 4.2,
                note: "İstanbul genelinde arz birikimi stabil, fiyatlar m² bazında enflasyonla paralel seyrediyor."
            },
            "Kağıthane": {
                listings: 4250,
                tuik: 680,
                m3: 5.4, m6: 12.1, y1: 18.5,
                history: [3200, 3300, 3450, 3600, 3700, 3850, 3900, 4000, 4100, 4150, 4200, 4250],
                tuikHistory: [450, 480, 500, 520, 550, 600, 580, 620, 650, 640, 660, 680],
                risk: 7.8,
                note: "Kağıthane'de yeni projelerle arz %18 arttı. Bölge değerleme açısından yüksek potansiyelli."
            },
            "Kadıköy": {
                listings: 9120,
                tuik: 1100,
                m3: 1.2, m6: 3.5, y1: 9.8,
                history: [8100, 8200, 8350, 8400, 8550, 8600, 8700, 8800, 8950, 9000, 9050, 9120],
                tuikHistory: [900, 950, 920, 1000, 1050, 1100, 1080, 1120, 1150, 1130, 1110, 1100],
                risk: 2.1,
                note: "Kadıköy'de arz doygunluğa ulaştı, satışlar oturmuş (stabil) bir seyir izliyor."
            }
        };

        // --- MAP SYSTEM ---
        const map = L.map('map', { zoomControl: false }).setView([41.0082, 28.9784], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        const districts = [
            { name: "Kağıthane", pos: [41.0812, 28.9723], color: "#3b82f6" },
            { name: "Kadıköy", pos: [40.9910, 29.0270], color: "#8b5cf6" },
            { name: "Beşiktaş", pos: [41.0428, 29.0075], color: "#ec4899" },
            { name: "Esenyurt", pos: [41.0343, 28.6801], color: "#f59e0b" }
        ];

        districts.forEach(d => {
            const marker = L.circleMarker(d.pos, {
                radius: 12,
                fillColor: d.color,
                color: "#fff",
                weight: 3,
                fillOpacity: 0.9
            }).addTo(map);

            marker.on('click', () => updateDashboard(d.name));
            marker.bindTooltip(d.name, { permanent: false, direction: 'top' });
        });

        // --- CHART SYSTEM ---
        const ctx = document.getElementById('trendChart').getContext('2d');
        let trendChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Şub 25', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara', 'Oca 26'],
                datasets: [
                    {
                        label: 'İlan Sayısı (Arz)',
                        data: MASTER_DATA["İstanbul Geneli"].history,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.05)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3
                    },
                    {
                        label: 'TÜİK Satış (Talep)',
                        data: MASTER_DATA["İstanbul Geneli"].tuikHistory,
                        borderColor: '#10b981',
                        borderDash: [5, 5],
                        tension: 0.1,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                scales: {
                    y: { type: 'linear', display: true, position: 'left' },
                    y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false } }
                }
            }
        });

        // --- CORE LOGIC (UPDATE FUNCTION) ---
        function updateDashboard(key) {
            const data = MASTER_DATA[key] || MASTER_DATA["İstanbul Geneli"];
            
            // UI Güncelleme
            document.getElementById('activeZone').innerText = key;
            document.getElementById('mainListingCount').innerText = data.listings.toLocaleString();
            document.getElementById('tuikSales').innerText = data.tuik.toLocaleString() + " / ay";
            
            // 3-6-12 Ay Hesaplamaları
            document.getElementById('m3-change').innerText = (data.m3 > 0 ? "+" : "") + data.m3 + "%";
            document.getElementById('m6-change').innerText = (data.m6 > 0 ? "+" : "") + data.m6 + "%";
            document.getElementById('y1-change').innerText = (data.y1 > 0 ? "+" : "") + data.y1 + "%";

            // Likidite Barı
            const liq = ((data.tuik / data.listings) * 100).toFixed(1);
            document.getElementById('liquidityBar').style.width = (liq * 2) + "%"; // Görselleştirme amaçlı çarpan
            
            // Risk Skoru
            document.getElementById('riskScore').innerText = data.risk + " / 10";
            document.getElementById('riskText').innerText = data.note;

            // Grafik Güncelleme
            trendChart.data.datasets[0].data = data.history;
            trendChart.data.datasets[1].data = data.tuikHistory;
            trendChart.update();

            // Harita Odaklanma
            const dist = districts.find(d => d.name === key);
            if(dist) map.flyTo(dist.pos, 13);
        }

        function resetData() {
            updateDashboard("İstanbul Geneli");
            map.flyTo([41.0082, 28.9784], 10);
        }
    </script>
</body>
</html>

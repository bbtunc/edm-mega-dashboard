<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İstanbul Mega Emlak Değerleme Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        #map { height: 500px; border-radius: 15px; z-index: 10; border: 2px solid #e2e8f0; }
        .glass-effect { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .stat-card { transition: transform 0.2s; cursor: pointer; }
        .stat-card:hover { transform: translateY(-5px); }
        .negative-trend { color: #ef4444; }
        .positive-trend { color: #22c55e; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900">

    <div class="flex flex-col min-h-screen">
        <nav class="bg-slate-900 text-white p-4 shadow-xl">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-blue-600 p-2 rounded-lg"><i class="fas fa-city text-xl"></i></div>
                    <div>
                        <h1 class="text-xl font-bold leading-tight uppercase tracking-widest">Mega Değerleme Paneli</h1>
                        <p class="text-[10px] text-blue-400">TÜİK & SAHİBİNDEN ENTEGRE ANALİZ SİSTEMİ</p>
                    </div>
                </div>
                <div class="hidden md:flex space-x-6 text-sm font-medium">
                    <span class="flex items-center"><i class="fas fa-calendar-alt mr-2"></i> ŞUBAT 2026</span>
                    <span class="flex items-center text-green-400"><i class="fas fa-sync-alt mr-2"></i> Canlı Veri Bağlantısı Aktif</span>
                </div>
            </div>
        </nav>

        <main class="container mx-auto p-4 md:p-6 flex-grow">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <div>
                    <h2 class="text-3xl font-black text-slate-800" id="selectedAreaTitle">İstanbul Geneli</h2>
                    <p class="text-slate-500 font-medium">Seçili bölge için detaylı piyasa analizi ve değişim oranları.</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <button onclick="resetToIstanbul()" class="px-6 py-2 bg-white border-2 border-slate-200 rounded-full font-bold text-slate-600 hover:bg-slate-100 transition flex items-center">
                        <i class="fas fa-map-marked-alt mr-2"></i> İstanbul Geneline Dön
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 stat-card">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Toplam Satılık İlan</span>
                        <i class="fas fa-home text-blue-500"></i>
                    </div>
                    <p class="text-3xl font-black text-slate-800" id="stat-total-listings">135,654</p>
                    <div class="mt-2 text-xs font-bold" id="trend-12m">
                        <span class="positive-trend"><i class="fas fa-caret-up"></i> %12.4</span> 
                        <span class="text-slate-400 font-normal ml-1">(Son 1 Yıl)</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 stat-card">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">TÜİK Gerçekleşen Satış</span>
                        <i class="fas fa-handshake text-emerald-500"></i>
                    </div>
                    <p class="text-3xl font-black text-slate-800" id="stat-tuik-sales">18,240</p>
                    <div class="mt-2 text-xs font-bold" id="trend-6m">
                        <span class="positive-trend"><i class="fas fa-caret-up"></i> %4.2</span> 
                        <span class="text-slate-400 font-normal ml-1">(Son 6 Ay)</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 stat-card">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Ort. m² Birim Fiyatı</span>
                        <i class="fas fa-lira-sign text-orange-500"></i>
                    </div>
                    <p class="text-3xl font-black text-slate-800" id="stat-avg-price">48,250 TL</p>
                    <div class="mt-2 text-xs font-bold" id="trend-3m">
                        <span class="positive-trend"><i class="fas fa-caret-up"></i> %2.1</span> 
                        <span class="text-slate-400 font-normal ml-1">(Son 3 Ay)</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 stat-card bg-gradient-to-br from-blue-50 to-white">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-blue-800 uppercase">Piyasa Likidite Skoru</span>
                        <i class="fas fa-chart-pie text-blue-600"></i>
                    </div>
                    <p class="text-3xl font-black text-blue-600" id="stat-liquidity">%13.4</p>
                    <div class="mt-2 text-xs font-bold">
                        <span id="analysis-text" class="text-blue-800 uppercase tracking-tighter italic font-black">STABİL PİYASA</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <div class="xl:col-span-2 space-y-6">
                    <div class="bg-white p-4 rounded-3xl shadow-lg border border-slate-200">
                        <div class="flex justify-between items-center mb-4 px-2">
                            <h3 class="font-bold text-slate-700">İnteraktif İstanbul Haritası (İlçe Bazlı Kırılım)</h3>
                            <div class="flex space-x-2">
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-1 rounded font-bold uppercase">Yüksek Arz</span>
                                <span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded font-bold uppercase">Düşük Arz</span>
                            </div>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-3xl shadow-lg border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-6 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-blue-600"></i> 12 Aylık Arz & Satış Trendi
                        </h3>
                        <div class="h-[250px]">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-slate-900 text-white p-6 rounded-3xl shadow-xl">
                        <h3 class="font-bold text-blue-400 mb-4 uppercase text-sm tracking-widest">Uzman Değerleme Notu</h3>
                        <p id="valuation-note" class="text-sm text-slate-300 leading-relaxed italic">
                            "İstanbul genelinde arz birikimi devam ediyor. 135.654 ilan, piyasadaki doygunluğu gösterirken; TÜİK satışlarının sabit kalması, alıcıların beklemede olduğunu kanıtlıyor."
                        </p>
                        <div class="mt-6 pt-6 border-t border-slate-800 flex justify-between items-center">
                            <span class="text-xs font-bold text-slate-500 italic">İST-DEĞERLEME V.2</span>
                            <div class="flex -space-x-2">
                                <div class="w-8 h-8 rounded-full bg-blue-500 border-2 border-slate-900"></div>
                                <div class="w-8 h-8 rounded-full bg-emerald-500 border-2 border-slate-900"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. VERİ YAPISI (İstanbul ve İlçeler İçin Örnek Veri Seti) ---
        const dataStore = {
            "İstanbul Geneli": {
                totalListings: 135654,
                tuikSales: 18240,
                avgPrice: 48250,
                history: [110000, 115000, 118000, 122000, 125000, 128000, 130000, 132000, 133000, 134500, 135000, 135654],
                tuikHistory: [15200, 16100, 14800, 17200, 18500, 19000, 17800, 18200, 19500, 18800, 18100, 18240],
                trends: { y1: 12.4, m6: 4.2, m3: 2.1 },
                note: "Arzın yüksek, talebin stabil olduğu bir dönem. Nakit kraldır (Cash is King) evresi gözlemleniyor."
            },
            "Kağıthane": {
                totalListings: 4250,
                tuikSales: 840,
                avgPrice: 38400,
                history: [3200, 3400, 3500, 3600, 3750, 3800, 3900, 4000, 4100, 4150, 4200, 4250],
                tuikHistory: [600, 650, 620, 700, 750, 800, 780, 810, 850, 830, 820, 840],
                trends: { y1: 18.2, m6: 6.5, m3: 3.8 },
                note: "Kağıthane bölgesi kentsel dönüşüm ve merkezi konumuyla arzını hızla artırıyor. Yatırım potansiyeli yüksek."
            },
            "Kadıköy": {
                totalListings: 8120,
                tuikSales: 1100,
                avgPrice: 155200,
                history: [7100, 7200, 7400, 7500, 7600, 7700, 7800, 7900, 8000, 8050, 8100, 8120],
                tuikHistory: [900, 950, 920, 1000, 1050, 1100, 1080, 1120, 1150, 1130, 1110, 1100],
                trends: { y1: 14.3, m6: 3.1, m3: 1.2 },
                note: "Fiyat doygunluğu en yüksek bölge. Satış hızı yavaşlamış olsa da metrekare değerleri korunuyor."
            }
            // Diğer ilçeler için benzer veriler eklenebilir...
        };

        // --- 2. HARİTA KURULUMU ---
        const map = L.map('map').setView([41.0082, 28.9784], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Örnek İlçe Markerları (Gerçek GeoJSON yerine hızlı etkileşim için)
        const districts = [
            { name: "Kağıthane", coords: [41.0812, 28.9723] },
            { name: "Kadıköy", coords: [40.9910, 29.0270] },
            { name: "Esenyurt", coords: [41.0343, 28.6801] },
            { name: "Beşiktaş", coords: [41.0428, 29.0075] },
            { name: "Ümraniye", coords: [41.0333, 29.1013] }
        ];

        districts.forEach(d => {
            const circle = L.circle(d.coords, {
                color: '#3b82f6',
                fillColor: '#60a5fa',
                fillOpacity: 0.5,
                radius: 1200
            }).addTo(map);

            circle.on('click', () => updateDashboard(d.name));
            circle.bindTooltip(d.name, { permanent: false, direction: "top" });
        });

        // --- 3. GRAFİK KURULUMU ---
        const ctx = document.getElementById('trendChart').getContext('2d');
        let trendChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Şub 25', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara', 'Oca 26'],
                datasets: [{
                    label: 'Sahibinden Arz (İlan)',
                    data: dataStore["İstanbul Geneli"].history,
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'TÜİK Satış',
                    data: dataStore["İstanbul Geneli"].tuikHistory,
                    borderColor: '#10b981',
                    borderDash: [5, 5],
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' } },
                scales: { y: { beginAtZero: false } }
            }
        });

        // --- 4. DASHBOARD GÜNCELLEME FONKSİYONU ---
        function updateDashboard(areaName) {
            const data = dataStore[areaName] || dataStore["İstanbul Geneli"]; // Veri yoksa genele dön
            
            // Başlık Güncelle
            document.getElementById('selectedAreaTitle').innerText = areaName;
            
            // KPI Güncelle
            document.getElementById('stat-total-listings').innerText = data.totalListings.toLocaleString();
            document.getElementById('stat-tuik-sales').innerText = data.tuikSales.toLocaleString();
            document.getElementById('stat-avg-price').innerText = data.avgPrice.toLocaleString() + " TL";
            
            // Likidite Skoru Hesapla
            const liquidity = ((data.tuikSales / data.totalListings) * 100).toFixed(1);
            document.getElementById('stat-liquidity').innerText = "%" + liquidity;
            
            // Trend Oranları
            document.getElementById('trend-12m').innerHTML = `<span class="positive-trend"><i class="fas fa-caret-up"></i> %${data.trends.y1}</span> <span class="text-slate-400 font-normal ml-1">(Son 1 Yıl)</span>`;
            document.getElementById('trend-6m').innerHTML = `<span class="positive-trend"><i class="fas fa-caret-up"></i> %${data.trends.m6}</span> <span class="text-slate-400 font-normal ml-1">(Son 6 Ay)</span>`;
            document.getElementById('trend-3m').innerHTML = `<span class="positive-trend"><i class="fas fa-caret-up"></i> %${data.trends.m3}</span> <span class="text-slate-400 font-normal ml-1">(Son 3 Ay)</span>`;

            // Grafik Güncelle
            trendChart.data.datasets[0].data = data.history;
            trendChart.data.datasets[1].data = data.tuikHistory;
            trendChart.update();

            // Uzman Notu
            document.getElementById('valuation-note').innerText = `"${data.note}"`;
            
            // Likidite Analiz Metni
            const analysisText = document.getElementById('analysis-text');
            if(liquidity > 15) {
                analysisText.innerText = "HIZLI PİYASA / TALEP YÜKSEK";
                analysisText.className = "text-emerald-600 font-black italic uppercase";
            } else {
                analysisText.innerText = "STABİL PİYASA / ARZ BİRİKİMİ";
                analysisText.className = "text-blue-600 font-black italic uppercase";
            }
        }

        function resetToIstanbul() {
            updateDashboard("İstanbul Geneli");
            map.setView([41.0082, 28.9784], 10);
        }

    </script>
</body>
</html>

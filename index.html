<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İstanbul Değerleme Müdürlüğü | Veri Analiz Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 450px; border-radius: 12px; }
        .active-btn { background-color: #1e40af !important; color: white !important; }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="max-w-7xl mx-auto p-6">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 bg-white p-6 rounded-2xl shadow-sm border border-blue-100">
            <div>
                <h1 class="text-2xl font-black text-gray-800 uppercase tracking-tight">İstanbul Emlak Analiz Sistemi</h1>
                <p class="text-blue-600 font-medium text-sm">TÜİK & Sahibinden Entegre Veri Projeksiyonu (2026)</p>
            </div>
            <div class="mt-4 md:mt-0 flex flex-wrap gap-2" id="periodFilters">
                <button onclick="changePeriod('5y', this)" class="px-4 py-2 bg-white border text-gray-600 rounded-lg text-xs font-bold hover:bg-gray-50 transition">5 YILLIK</button>
                <button onclick="changePeriod('1y', this)" class="px-4 py-2 bg-white border text-gray-600 rounded-lg text-xs font-bold hover:bg-gray-50 transition">1 YILLIK</button>
                <button onclick="changePeriod('6m', this)" class="px-4 py-2 bg-white border text-gray-600 rounded-lg text-xs font-bold hover:bg-gray-50 transition">6 AYLIK</button>
                <button onclick="changePeriod('3m', this)" class="px-4 py-2 bg-white border text-gray-600 rounded-lg text-xs font-bold hover:bg-gray-50 transition">3 AYLIK</button>
                <button onclick="changePeriod('current', this)" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold active-btn">BU AY</button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                <h3 class="text-xs font-bold text-gray-400 uppercase">Toplam Satılık Arz (Sahibinden)</h3>
                <p id="kpi-arz" class="text-3xl font-black text-blue-700">135,654</p>
                <span class="text-xs text-gray-400">İstanbul geneli aktif ilan</span>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                <h3 class="text-xs font-bold text-gray-400 uppercase">TÜİK Gerçekleşen Satış</h3>
                <p id="kpi-satis" class="text-3xl font-black text-emerald-600">18,240</p>
                <span id="label-satis" class="text-xs text-gray-400">Son 1 ayda tamamlanan</span>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                <h3 class="text-xs font-bold text-gray-400 uppercase">Ortalama m² Değeri</h3>
                <p id="kpi-fiyat" class="text-3xl font-black text-gray-800">42,500 TL</p>
                <span class="text-xs text-orange-500 font-bold">↑ %4.1 (Trend)</span>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm">
                <h3 class="text-xs font-bold text-gray-400 uppercase">Likitite Oranı</h3>
                <p id="kpi-likidite" class="text-3xl font-black text-purple-600">%13.4</p>
                <span class="text-xs text-gray-400">Arzın satışa dönüşme hızı</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border">
                <h3 class="font-bold text-gray-800 mb-4">İlçe Bazlı Arz Yoğunluğu (Sahibinden Verisi)</h3>
                <div id="map"></div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border">
                <h3 class="font-bold text-gray-800 mb-4">Fiyat & Arz İlişkisi</h3>
                <canvas id="mainChart"></canvas>
                <div class="mt-6 text-sm text-gray-500 italic">
                    * Filtrelere tıklandığında TÜİK verileri (Maliyet Endeksi ve Satış) dinamik olarak güncellenir.
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STORE (TÜİK ve SAHİBİNDEN VERİLERİ) ---
        const dashboardData = {
            '5y': { arz: "1.240.500", satis: "840.000", fiyat: "18.200 TL", likidite: "%67.7", chart: [100, 250, 480, 720, 1100] },
            '1y': { arz: "450.200", satis: "195.400", fiyat: "34.100 TL", likidite: "%43.4", chart: [800, 850, 920, 1000, 1100] },
            '6m': { arz: "240.100", satis: "98.200", fiyat: "39.500 TL", likidite: "%40.8", chart: [950, 980, 1020, 1050, 1100] },
            '3m': { arz: "165.000", satis: "48.150", fiyat: "41.200 TL", likidite: "%29.1", chart: [1020, 1040, 1070, 1090, 1100] },
            'current': { arz: "135,654", satis: "18,240", fiyat: "42,500 TL", likidite: "%13.4", chart: [1080, 1085, 1090, 1095, 1100] }
        };

        // --- CHART BAŞLATMA ---
        const ctx = document.getElementById('mainChart').getContext('2d');
        let myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs'],
                datasets: [{
                    label: 'Konut Fiyat Endeksi (TÜİK)',
                    data: dashboardData['current'].chart,
                    backgroundColor: '#3b82f6',
                    borderRadius: 8
                }]
            }
        });

        // --- HARİTA BAŞLATMA ---
        const map = L.map('map').setView([41.0082, 28.9784], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Örnek İlçe Verileri (Senin 135.654 ilanının dağılımı gibi düşün)
        const districts = [
            { name: "Esenyurt", lat: 41.0343, lng: 28.6801, count: 22400 },
            { name: "Kadıköy", lat: 40.9910, lng: 29.0270, count: 12100 },
            { name: "Beşiktaş", lat: 41.0428, lng: 29.0075, count: 5400 },
            { name: "Pendik", lat: 40.8767, lng: 29.2335, count: 8900 }
        ];

        districts.forEach(d => {
            L.circle([d.lat, d.lng], { color: '#3b82f6', radius: d.count / 2 }).addTo(map)
             .bindPopup(`<b>${d.name}</b><br>İlan Sayısı: ${d.count}`);
        });

        // --- BUTON ÇALIŞTIRMA FONKSİYONU ---
        function changePeriod(period, btn) {
            // Buton Stilini Güncelle
            document.querySelectorAll('#periodFilters button').forEach(b => b.classList.remove('active-btn', 'bg-blue-600', 'text-white'));
            btn.classList.add('active-btn', 'bg-blue-600', 'text-white');

            // Verileri Güncelle
            const data = dashboardData[period];
            document.getElementById('kpi-arz').innerText = data.arz;
            document.getElementById('kpi-satis').innerText = data.satis;
            document.getElementById('kpi-fiyat').innerText = data.fiyat;
            document.getElementById('kpi-likidite').innerText = data.likidite;

            // Grafiği Güncelle
            myChart.data.datasets[0].data = data.chart;
            myChart.update();

            // Alt metni güncelle
            document.getElementById('label-satis').innerText = period === 'current' ? "Son 1 ayda tamamlanan" : period + " toplam satış";
        }
    </script>
</body>
</html>

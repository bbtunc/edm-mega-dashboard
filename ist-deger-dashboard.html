<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°ST-DEÄžER | Ä°stanbul DeÄŸerleme Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #e8eef3 0%, #f5f7fa 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #main-map { 
            height: calc(100vh - 180px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .sidebar {
            height: calc(100vh - 100px);
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: transparent; }
        .sidebar::-webkit-scrollbar-thumb { 
            background: rgba(0,0,0,0.1); 
            border-radius: 10px; 
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .card-header {
            font-weight: 700;
            font-size: 16px;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .data-row:last-child { border-bottom: none; }
        
        .data-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        .data-value {
            font-weight: 700;
            font-size: 16px;
        }
        
        .earthquake-item {
            background: linear-gradient(to right, #fef2f2, #ffffff);
            border-left: 4px solid #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .weather-card {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.3);
        }
        
        .news-item {
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .news-item:hover {
            background: #f9fafb;
            padding-left: 8px;
        }
        
        .news-category {
            display: inline-block;
            font-size: 11px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        
        .news-category.ulasim { color: #ef4444; }
        
        .map-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        
        .stat-box {
            background: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            color: #9ca3af;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }
        
        .search-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
        }
        
        .search-input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: none;
            background: rgba(255,255,255,0.15);
            color: white;
            font-size: 14px;
            outline: none;
            margin-bottom: 12px;
        }
        
        .search-input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .search-btn {
            width: 100%;
            padding: 14px;
            background: #3b82f6;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f4f6;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .map-control-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .map-control-btn {
            width: 44px;
            height: 44px;
            background: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 16px;
            color: #374151;
        }
        
        .map-control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .map-control-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .chart-container {
            position: relative;
            height: 280px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white py-4 px-6 sticky top-0 z-50 shadow-lg">
        <div class="max-w-screen-2xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="text-2xl font-bold">
                    <span class="text-blue-400">Ä°ST</span><span class="text-white">-DEÄžER</span>
                </div>
                <div class="text-xs border border-slate-600 px-3 py-1 rounded-full">
                    Emlak ve DeÄŸerleme MÃ¼dÃ¼rlÃ¼ÄŸÃ¼
                </div>
            </div>
            <div id="clock" class="text-sm font-mono">06.02.2026 09:50:07</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-screen-2xl mx-auto px-6 py-6">
        <div class="grid grid-cols-12 gap-6">
            
            <!-- Left Sidebar -->
            <div class="col-span-3 sidebar">
                
                <!-- Economic Data -->
                <div class="card" style="border-top: 4px solid #10b981;">
                    <div class="card-header">
                        <i class="fas fa-chart-line text-green-500"></i>
                        Ekonomik Veriler
                    </div>
                    <div class="data-row">
                        <span class="data-label">USD/TRY</span>
                        <span class="data-value text-red-600" id="usd-rate">
                            <span class="loading"></span>
                        </span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Konut Fiyat End.</span>
                        <span class="data-value text-blue-600">%84.2</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">AkaryakÄ±t (Litre)</span>
                        <span class="data-value text-gray-700">42.15 â‚º</span>
                    </div>
                </div>

                <!-- Earthquakes -->
                <div class="card" style="border-top: 4px solid #ef4444;">
                    <div class="card-header">
                        <i class="fas fa-house-damage text-red-500"></i>
                        Son Depremler
                    </div>
                    <div id="earthquake-list">
                        <div class="flex justify-center py-6">
                            <span class="loading"></span>
                        </div>
                    </div>
                </div>

                <!-- Weather -->
                <div class="weather-card">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <div class="text-sm opacity-80 mb-1">Ä°stanbul</div>
                            <div class="text-5xl font-bold" id="temperature">14Â°C</div>
                        </div>
                        <i class="fas fa-cloud-sun text-5xl opacity-80"></i>
                    </div>
                    <div class="border-t border-white border-opacity-20 pt-4 mt-4">
                        <div class="text-sm opacity-90" id="prayer-time">
                            SÄ±radaki Vakit: Ä°kindi (15:42)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Map -->
            <div class="col-span-6">
                <div class="bg-white rounded-xl p-4 shadow-lg">
                    <div class="relative">
                        <!-- Map Controls -->
                        <div class="map-control-panel">
                            <button class="map-control-btn" onclick="loadLayer('ispark')" title="Ä°SPARK OtoparklarÄ±">
                                <i class="fas fa-parking"></i>
                            </button>
                            <button class="map-control-btn" onclick="loadLayer('pharmacy')" title="NÃ¶betÃ§i Eczaneler">
                                <i class="fas fa-pills"></i>
                            </button>
                            <button class="map-control-btn" onclick="loadLayer('metro')" title="Metro HatlarÄ±">
                                <i class="fas fa-train"></i>
                            </button>
                            <button class="map-control-btn" onclick="clearLayers()" title="Temizle">
                                <i class="fas fa-eraser"></i>
                            </button>
                        </div>
                        
                        <div id="main-map"></div>
                    </div>
                    
                    <!-- Map Stats -->
                    <div class="map-stats">
                        <div class="stat-box">
                            <div class="stat-label">Ä°BB Trafik</div>
                            <div class="stat-value text-orange-500">%42</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Aktif Ä°lan</div>
                            <div class="stat-value text-blue-600">12.4k</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Hava Kalitesi</div>
                            <div class="stat-value text-green-500">Ä°yi</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Toplu TaÅŸÄ±ma</div>
                            <div class="stat-value text-blue-800">Normal</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="col-span-3 sidebar">
                
                <!-- News -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-newspaper text-blue-500"></i>
                        Haber AkÄ±ÅŸÄ±
                    </div>
                    <div id="news-feed">
                        <div class="news-item">
                            <div class="news-category">EKONOMÄ°</div>
                            <div class="text-sm font-medium text-gray-800">Ä°stanbul'da konut satÄ±ÅŸlarÄ± arttÄ±...</div>
                        </div>
                        <div class="news-item">
                            <div class="news-category ulasim">ULAÅžIM</div>
                            <div class="text-sm font-medium text-gray-800">Yeni metro hattÄ± deÄŸerleri uÃ§urdu.</div>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-bar text-blue-500"></i>
                        Birim DeÄŸer Analizi
                    </div>
                    <div class="chart-container">
                        <canvas id="districtChart"></canvas>
                    </div>
                </div>

                <!-- Search -->
                <div class="search-card">
                    <div class="text-sm font-bold uppercase tracking-wider mb-4">HÄ±zlÄ± Sorgu</div>
                    <input 
                        type="text" 
                        class="search-input" 
                        placeholder="2 ada 15 parsle"
                        id="search-input"
                    >
                    <button class="search-btn" onclick="performSearch()">
                        <i class="fas fa-search mr-2"></i>Sorgula
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Attribution -->
    <div class="text-center py-4 text-xs text-gray-500">
        <i class="fas fa-map-marked-alt mr-1"></i>
        <a href="#" class="text-blue-600">Leaflet</a> | Ä°ST-DEÄžER v2.0 | Veriler: Ä°BB, MGM, TCMB
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ===========================================
        // GLOBAL VARIABLES
        // ===========================================
        let map;
        let markersLayer = L.layerGroup();
        let activeLayer = null;

        // ===========================================
        // CLOCK UPDATE
        // ===========================================
        function updateClock() {
            const now = new Date();
            const formatted = now.toLocaleString('tr-TR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).replace(',', '');
            document.getElementById('clock').textContent = formatted;
        }

        setInterval(updateClock, 1000);

        // ===========================================
        // MAP INITIALIZATION
        // ===========================================
        function initMap() {
            map = L.map('main-map', {
                zoomControl: true
            }).setView([41.0082, 28.9784], 11);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: 'Â© OpenStreetMap Â© CARTO',
                maxZoom: 19
            }).addTo(map);

            markersLayer.addTo(map);

            // Add custom zoom control position
            map.zoomControl.setPosition('topright');
        }

        // ===========================================
        // EXCHANGE RATES (TCMB EVDS)
        // ===========================================
        async function fetchExchangeRates() {
            try {
                // Simulating API call - replace with real TCMB EVDS API
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const mockRates = {
                    USD: 31.24,
                    EUR: 33.87,
                    change: '+0.12'
                };

                document.getElementById('usd-rate').innerHTML = `${mockRates.USD.toFixed(2)} â‚º`;

            } catch (error) {
                console.error('DÃ¶viz kuru hatasÄ±:', error);
                document.getElementById('usd-rate').textContent = 'Hata';
            }
        }

        // ===========================================
        // EARTHQUAKES (Kandilli/AFAD)
        // ===========================================
        async function fetchEarthquakes() {
            try {
                // Using free earthquake API
                const response = await fetch('https://api.orhanaydogdu.com.tr/deprem/kandilli/live');
                const data = await response.json();

                if (data.status && data.result) {
                    const earthquakes = data.result.slice(0, 2);
                    
                    const html = earthquakes.map(eq => `
                        <div class="earthquake-item">
                            <div>
                                <div class="font-bold text-red-600">${eq.mag} - ${eq.title}</div>
                                <div class="text-xs text-gray-500 mt-1">${eq.date}</div>
                            </div>
                            <div class="text-xs text-gray-400">${new Date(eq.date).toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})}</div>
                        </div>
                    `).join('');

                    document.getElementById('earthquake-list').innerHTML = html;
                }

            } catch (error) {
                console.error('Deprem verisi hatasÄ±:', error);
                document.getElementById('earthquake-list').innerHTML = `
                    <div class="text-center text-sm text-red-500 py-4">
                        Veri alÄ±namadÄ±
                    </div>
                `;
            }
        }

        // ===========================================
        // WEATHER (OpenWeatherMap)
        // ===========================================
        async function fetchWeather() {
            try {
                // Mock weather data - replace with OpenWeatherMap API
                const mockWeather = {
                    temp: 14,
                    description: 'ParÃ§alÄ± Bulutlu'
                };

                document.getElementById('temperature').textContent = `${mockWeather.temp}Â°C`;

            } catch (error) {
                console.error('Hava durumu hatasÄ±:', error);
            }
        }

        // ===========================================
        // MAP LAYERS
        // ===========================================
        async function loadLayer(type) {
            // Clear previous layers
            markersLayer.clearLayers();

            // Remove active state from all buttons
            document.querySelectorAll('.map-control-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Set active layer
            activeLayer = type;
            event.currentTarget.classList.add('active');

            if (type === 'ispark') {
                // Ä°SPARK parking lots
                const mockParking = [
                    {name: 'KadÄ±kÃ¶y Ä°SPARK', lat: 40.9833, lon: 29.0333, capacity: 150, available: 45},
                    {name: 'BeÅŸiktaÅŸ Ä°SPARK', lat: 41.0425, lon: 29.0058, capacity: 200, available: 78},
                    {name: 'ÅžiÅŸli Ä°SPARK', lat: 41.0602, lon: 28.9887, capacity: 180, available: 92}
                ];

                mockParking.forEach(park => {
                    const marker = L.marker([park.lat, park.lon], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background: #3b82f6; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"><i class="fas fa-parking"></i></div>`,
                            iconSize: [32, 32]
                        })
                    });

                    marker.bindPopup(`
                        <div style="padding: 8px;">
                            <div style="font-weight: 700; margin-bottom: 8px;">${park.name}</div>
                            <div style="font-size: 12px;">Kapasite: ${park.capacity}</div>
                            <div style="font-size: 12px; color: #10b981;">BoÅŸ: ${park.available}</div>
                        </div>
                    `);

                    markersLayer.addLayer(marker);
                });

            } else if (type === 'pharmacy') {
                // Pharmacies
                const mockPharmacies = [
                    {name: 'Eczane KadÄ±kÃ¶y', lat: 40.9833, lon: 29.0333},
                    {name: 'Eczane BeÅŸiktaÅŸ', lat: 41.0425, lon: 29.0058},
                    {name: 'Eczane ÅžiÅŸli', lat: 41.0602, lon: 28.9887}
                ];

                mockPharmacies.forEach(pharmacy => {
                    const marker = L.marker([pharmacy.lat, pharmacy.lon], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background: #ef4444; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"><i class="fas fa-pills"></i></div>`,
                            iconSize: [32, 32]
                        })
                    });

                    marker.bindPopup(`
                        <div style="padding: 8px;">
                            <div style="font-weight: 700; margin-bottom: 4px;">${pharmacy.name}</div>
                            <div style="font-size: 12px;">NÃ¶betÃ§i Eczane</div>
                        </div>
                    `);

                    markersLayer.addLayer(marker);
                });

            } else if (type === 'metro') {
                // Metro stations
                const mockMetro = [
                    {name: 'KadÄ±kÃ¶y Metro', lat: 40.9833, lon: 29.0333, line: 'M4'},
                    {name: 'BeÅŸiktaÅŸ Metro', lat: 41.0425, lon: 29.0058, line: 'M7'},
                    {name: 'ÅžiÅŸli Metro', lat: 41.0602, lon: 28.9887, line: 'M2'}
                ];

                mockMetro.forEach(station => {
                    const marker = L.marker([station.lat, station.lon], {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"><i class="fas fa-train"></i></div>`,
                            iconSize: [32, 32]
                        })
                    });

                    marker.bindPopup(`
                        <div style="padding: 8px;">
                            <div style="font-weight: 700; margin-bottom: 4px;">${station.name}</div>
                            <div style="font-size: 12px;">Hat: ${station.line}</div>
                        </div>
                    `);

                    markersLayer.addLayer(marker);
                });
            }
        }

        function clearLayers() {
            markersLayer.clearLayers();
            activeLayer = null;
            document.querySelectorAll('.map-control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // ===========================================
        // CHART
        // ===========================================
        function initChart() {
            const ctx = document.getElementById('districtChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Kdy', 'BÅŸk', 'ÅžiÅŸ', 'SarÄ±'],
                    datasets: [{
                        label: 'mÂ² FiyatÄ± (bin â‚º)',
                        data: [85, 92, 110, 145],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'],
                        borderRadius: 8,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { font: { size: 11 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }

        // ===========================================
        // SEARCH
        // ===========================================
        function performSearch() {
            const query = document.getElementById('search-input').value;
            if (!query.trim()) {
                alert('LÃ¼tfen bir arama terimi girin');
                return;
            }
            alert(`"${query}" iÃ§in arama yapÄ±lÄ±yor...\n\nBu Ã¶zellik yakÄ±nda aktif olacak.`);
        }

        // Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        });

        // ===========================================
        // INITIALIZATION
        // ===========================================
        async function init() {
            console.log('ðŸš€ Ä°ST-DEÄžER Dashboard baÅŸlatÄ±lÄ±yor...');
            
            initMap();
            initChart();
            updateClock();

            await Promise.all([
                fetchExchangeRates(),
                fetchEarthquakes(),
                fetchWeather()
            ]);

            // Refresh data periodically
            setInterval(fetchExchangeRates, 60000); // Every minute
            setInterval(fetchEarthquakes, 300000); // Every 5 minutes
            setInterval(fetchWeather, 600000); // Every 10 minutes

            console.log('âœ… Dashboard hazÄ±r!');
        }

        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>